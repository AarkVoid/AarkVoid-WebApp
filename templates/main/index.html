{% extends 'base.html' %}
{% load static %}
{% block title %} Homepage {% endblock title %}

{% block style %}
    <style>
        .white {
            color: #fff;
        }
        .custom-img {
            max-width: 450px;
            max-height: 450px;
            width: auto;
            height: auto;
        }
    </style>
{% endblock style %}

{% block content %}

{% if messages %}
<div class="container">
    {% for message in messages %}
    <div class="alert alert-{% if message.tags %}{{ message.tags }}{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %} 

<!-- Start Main Banner Area -->
<div class="main-banner bg-two">
    <div class="d-table">
        <div class="d-table-cell">
            <div class="container">
                <div class="row align-items-center">
                    <div class="text-center mb-4 d-flex justify-content-between align-items-center">
                        {% if user.is_staff %}
                            <button class="btn btn-success btn-sm" onclick="toggleBannerEdit()" id="editTrainerBtn">Edit Banner</button>
                            <button class="btn btn-primary btn-sm ms-2" id="saveTrainerBtn" style="display:none;" onclick="saveBannerChanges()">Save Changes</button>
                        {% endif %}
                    </div>
                    
                    <div class="col-lg-7">
                        <div class="main-banner-content">
                            <h4 id="banner_subtitle" contenteditable="false" >{{ banner.small_heading }}</h4>
                            <h1 id="banner_head" contenteditable="false" >{{ banner.main_heading }}</h1>
                            <p id="banner_discription" contenteditable="false" >{{ banner.description }}</p>
                        </div>



                        <div class="banner-btn">
                            <a href="{% url 'service_view' %}" class="default-btn">
                                Services
                                <span></span>
                            </a>

                            <a href="{% url 'contact_view' %}" class="default-btn-two">
                                Contact Us
                                <span></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<form id="bannerEditForm" method="post" action="{% url 'update_banner' %}" style="display: none;">
    {% csrf_token %}
    <input type="hidden" name="banner_id" id="input_banner_id" value="{{ banner.id }}" >
    <input type="hidden" name="banner_subtitle" id="input_banner_subtitle">
    <input type="hidden" name="banner_head" id="input_banner_head">
    <input type="hidden" name="banner_discription" id="input_banner_discription">
</form>
<!-- End Main Banner Area -->

<!-- Start About Area -->
<section class="about-area ptb-100">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="about-image">
                    <img src="{% static 'assets/img/about-2.png' %}" alt="image">
                </div>
            </div>

            <div class="col-lg-6">
                <div class="about-content">
                    <span>About Us</span>
                    <h3 id="about_title" contenteditable="false" >{{ about_us.title }}</h3>
                    <p id="about_discription" contenteditable="false" >{{ about_us.description }}</p>

                    <ul class="about-features two">
                        {% if about_topics %}
                            {% for topic in about_topics %}
                                <li>
                                    <span>
                                        <i class='{{ topic.icon_label }}'></i>
                                        {{ topic.title }}
                                    </span>
                                </li>
                            {% endfor %}
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End About Area -->

<!-- Start Services Area -->
<section class="services-area pt-100 pb-70">
    <div class="container">
        <div class="section-title">
            <span>{{ service_detail.page_tile }}</span>
            <h2>{{ service_detail.page_head }}</h2>
            <p>{{ service_detail.description }}</p>
        </div>

        <div class="row">
            {% if services %}
                {% for service in services %}
                    <div class="col-lg-4 col-md-6">
                        <div class="services-item bg-1">
                            <div class="icon">
                                <i class="flaticon-bacteria"></i>
                            </div>
                            <a href="{% url 'service_details' service.id %}">
                                <h3>{{ service.serviceName }}</h3>
                            </a>
                            <p>{{ service.serviceDescription|truncatechars:80 }}</p>
                            <a href="{% url 'service_details' service.id %}" class="read-btn">Read More +</a>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        
            <a href="{% url 'service_view' %}" class="text-center">
                <button class="default-btn">
                    More Services
                    <span></span>
                </button>
            </a>
        </div>
    </div>
</section>
<!-- End Services Area -->

<!-- Start team Area -->
<section class="doctor-area pt-100 pb-70">
    <div class="container-fluid">
        <div class="section-title">
            <div class="section-title">
                <span>{{ founder_details.legend }}</span>
                <h2>{{ founder_details.title }}</h2>
                <p>{{ founder_details.description }}</p>
            </div>
        </div>

        <div class="row">

            {% if founders %}
                {% for founder in founders %}
                    <div class="col-lg-4 col-md-6">
                        <div class="doctor-item">
                            <div class="image">
                                <img src="{{ founder.user.avatar.url }}" alt="image" class="custom-img rounded">
                            </div>
                            <div class="content">
                                <h3>{{ founder.user.user.first_name }} {{ founder.user.middle_name }} {{ founder.user.user.last_name }}</h3>
                                <span>Profession: {{ founder.user.profession }}</span>

                                <ul class="social">
                                    {% if founder_social_links %}
                                        {% for link in founder_social_links %}
                                            {% if link.enable %}
                                                <li>
                                                    <a href="{{ link.link }}" target="_blank">
                                                        <i class="{{ link.icon_label }}"></i>
                                                    </a>
                                                </li>
                                            {% endif %}
                                        {% endfor %}    
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
            
        </div>
    </div>
</section>
<!-- End team Area -->

<!-- Start Testimonials Area -->
<section class="testimonials-area ptb-100 a ">
    <div class="container-fluid">
        <div class="row align-items-center">


            <div class="col-lg-12">
                <div class="testimonials-slider owl-carousel owl-theme">

                    {% if testimonials %}
                        {% for quote in testimonials %}
                            <div class="testimonials-item">
                                <div class="content">
                                    <span>Testimonials</span>
                                    <h3 class="white">What Client’s Say About Us</h3>
                                    <div class="icon">
                                        <i class="flaticon-left-quote"></i>
                                    </div>
                                    <p>{{ quote.thoughts }}</p>

                                    <div class="info">
                                        <img src="{{ quote.user.avatar.url }}" alt="image">
                                        <h4 class="white">{{ quote.user.user.username }}</h4>
                                        <p>{{ quote.user.profession }}</p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Testimonials Area -->




<!-- Start Goal Area -->
<section class="app-area  ptb-100">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="app-image">
                    <img src="{{ appfeatures.image.url }}" alt="image">
                </div>
            </div>

            <div class="col-lg-6">
                <div class="app-content two">
                    
                    <h3>{{ appfeatures.title }}</h3>
                    <p>
                        {{ appfeatures.description }}
                    </p>

                    {% for feature in appfeatures.features.all %}
                        <div class="app-text">
                            <div class="icon">
                                <i class="flaticon-broadcasting"></i>
                            </div>
                            <h4>{{ feature.title }}</h4>
                            <p>{{ feature.description }}</p>
                        </div> 
                   {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Goal Area -->

<!-- Start enquery Area -->
<section class="appointment-area ptb-100">
    <div class="container-fluid">
        <div class="row align-items-center justify-content-around">
            <!-- <div class="col-lg-6">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="single-fun-fact">
                            <h3>
                                <span class="odometer" data-count="2700">00</span>
                                <span class="sign-icon">+</span>
                            </h3>
                            <p>Projects</p>
                        </div>
                    </div>

                    <div class="col-lg-6 col-md-6">
                        <div class="single-fun-fact">
                            <h3>
                                <span class="odometer" data-count="2.7">00</span>
                                <span class="sign-icon">K</span>
                            </h3>
                            <p>Clients</p>
                        </div>
                    </div>

                    <div class="col-lg-6 col-md-6">
                        <div class="single-fun-fact">
                            <h3>
                                <span class="odometer" data-count="99.60">00</span>
                                <span class="sign-icon">%</span>
                            </h3>
                            <p>Accuracy</p>
                        </div>
                    </div>

                    <div class="col-lg-6 col-md-6">
                        <div class="single-fun-fact">
                            <h3>
                                <span class="odometer" data-count="30">00</span>
                                <span class="sign-icon">+</span>
                            </h3>
                            <p>Teams</p>
                        </div>
                    </div>
                </div>
            </div> -->

            <div class="col-lg-6">
                <div class="project-request-form appointment-form">
                    <!-- Loading bar -->
                    <div id="loadingBar" style="display:none; width:0; height:4px; background:#4CAF50; transition: width 2s;"></div>

                    <!-- Notification -->
                    <div id="notification" style="display:none; margin-top:10px; padding:8px; border-radius:6px; font-weight:500;"></div>

                    <div class="content mt-3">
                        <span>{{ contact_section.subtitle }}</span>
                        <h3>{{ contact_section.title }}</h3>
                    </div>
                    <form method="POST" id="projectForm">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="form-group">
                                    <input type="text" class="form-control" id="Name" name="client_name" {% if request.user.is_authenticated %} value="{{ request.user.first_name }} {{ request.user.last_name }}" {% endif %} placeholder="Enter Your Name">
                                    <i class="flaticon-user"></i>
                                </div>
                            </div>

                            <div class="col-lg-6 col-sm-6">
                                <div class="form-group">
                                    <input type="text" class="form-control" id="Email" name="client_email" {% if request.user.is_authenticated %} value="{{ request.user.email }}" {% endif %} placeholder="Enter Email">
                                    <i class="flaticon-email"></i>
                                </div>
                            </div>

                            <div class="col-lg-6 col-sm-6">
                                <div class="form-group">
                                    <input type="text" class="form-control" id="Phone" name="client_phone_number" placeholder="Enter Phone Number">
                                    <i class="flaticon-call"></i>
                                </div>
                            </div>

                            <div class="col-lg-6 col-sm-6">
                                <div class="form-group">
                                    <select name="client_project_type">
                                        <option value="0">Select Project Type</option>
                                        {% if client_project_types %}
                                            {% for client_project_type in client_project_types %}
                                                <option value="{{ client_project_type.id }}">{{ client_project_type.title }}</option>
                                            {% endfor %}
                                        {% endif %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-lg-6 col-sm-6">
                                <div class="form-group">
                                    <select name="client_working_type">
                                        <option value="0">Select Working Type</option>
                                        {% if client_working_types %}
                                            {% for client_working_type in client_working_types %}
                                                <option value="{{ client_working_type.id }}">{{ client_working_type.title }}</option>
                                            {% endfor %}
                                        {% endif %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-lg-6 col-sm-6">
                                <div class="form-group">
                                    <div class="input-group date" id="datetimepicker">
                                        <input type="text" class="form-control" name="date" placeholder="Date">
                                        <span class="input-group-addon"></span>
                                    </div>
                                    <i class="flaticon-calendar"></i>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-group">
                                    <textarea class="form-control" name="client_comment" rows="3" placeholder="Write your comments or project details here..."></textarea>
                                    <i class="flaticon-edit"></i>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="project-request-btn">
                                    <button type="submit" class="default-btn">
                                        Raise Project Request
                                        <span></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End enquery Area -->


<!-- pricing -->

<section class="pricing-section">
    <div class="container">
        <div class="sec-title text-center">
            <span class="title">Get plan</span>
            <h2>Choose a Plan</h2>
        </div>

        <div class="outer-box">
            <div class="row">
                {% for plan in plans %}
                    <div class="pricing-block col-lg-4 col-md-6 col-sm-12 wow fadeInUp" data-wow-delay="{{ forloop.counter0|add:'0ms' }}">
                        <div class="inner-box">
                            <div class="icon-box">
                                <div class="icon-outer"><i class="{{ plan.icon_class }}"></i></div>
                            </div>
                                <div class="price-box">
                                <div class="title">{{ plan.title }}</div>
                                <h4 class="price">${{ plan.price }}</h4>
                            </div>
                            <ul class="features">
                            {% for feature in plan.features.all %}
                                <li class="{% if feature.is_included %}true{% else %}false{% endif %}">{{ feature.description }}</li>
                            {% endfor %}
                            </ul>
                            <div class="btn-box">
                                <a href="{{ plan.view_link }}" class="theme-btn">View Plan</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}   
            </div>
        </div>
    </div>
</section>

<!-- pricing end -->



<!-- Start Projects Area -->
<!-- <section class="projects-area pt-100 pb-70">
    <div class="container-fluid">
        <div class="section-title">
            <span>{{ projectData.title }}</span>
            <h2>{{ projectData.subtitle }}</h2>
            <p>{{ projectData.text }}</p>
        </div>

        <div class="row">
            {% for project in Projects %}
            <div class="col-lg-4 col-md-6">
                <div class="projects-item">
                    <div class="image" >
                        <a href="#"  style="display: flex; justify-content: center;">
                            <img src="{{ project.image.url }}" style="height:250px; width:300px;" alt="image">
                        </a>
                    </div>
                    <div class="content">
                        <p>
                            <a href="#">
                                {{ project.title}}
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section> -->
<!-- End Projects Area -->


<!-- Start Blog Area -->
<section class="blog-area pt-100 pb-70">
    <div class="container-fluid">
        <div class="section-title">
            <span>News</span>
            <h2>{{ blogcontent.title }}</h2>
            <p>{{ blogcontent.content }}</p>
        </div>

        <div class="row">
            {% for blog in Blogs %}
                <div class="col-lg-4 col-md-6">
                    <div class="blog-item">
                        <div class="image">
                            {% comment %} <a href="{% url 'single_blog' blog.slug %}"> {% endcomment %}
                            <a href="#">
                                <img src="{{ blog.image.url }}" alt="{{ blog.title }}" style="height: 250px; width: 100%; object-fit: cover;">
                            </a>
                            <a href="#" class="date">{{ blog.date|date:"d F, Y" }}</a>
                        </div>

                        <div class="content">
                            <h3>
                                {% comment %} <a href="{% url 'single_blog' blog.slug %}">{{ blog.title }}</a> {% endcomment %}
                                 <a href="{% url 'Blog_details' blog.id %}">{{ blog.title }}</a>
                            </h3>
                            <a href="{% url 'Blog_details' blog.id %}" class="blog-btn">Read More +</a>
                            {% comment %} <a href="{% url 'single_blog' blog.slug %}" class="blog-btn">Read More +</a> {% endcomment %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>
<!-- End Blog Area -->


<!-- our partner Area -->
{% comment %} <div class="container mb-5">
    <div class="container-fluid">
        <div class="section-title">
            <span>News</span>
            <h2>Our Partners/ Our Clients</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
                et dolore magna aliqua. Quis ipsum su</p>
        </div>
    </div>

    <section class="customer-logos slider ">
        <div class="slide"><img src="{% static 'assets/img/partner/1.png' %}"></div>
        <div class="slide"><img src="{% static 'assets/img/partner/2.png' %}"></div>
        <div class="slide"><img src="{% static 'assets/img/partner/3.png' %}"></div>
        <div class="slide"><img src="{% static 'assets/img/partner/4.png' %}"></div>
        <div class="slide"><img src="{% static 'assets/img/partner/5.png' %}"></div>
        <div class="slide"><img src="{% static 'assets/img/partner/1.png' %}"></div>
        <div class="slide"><img src="{% static 'assets/img/partner/4.png' %}"></div>

    </section>

</div> {% endcomment %}
{% endblock content %}

{% block scripts %} 
    <script>
        function toggleBannerEdit() {
        
            document.getElementById(`banner_subtitle`).contentEditable = 'true';
            document.getElementById(`banner_head`).contentEditable = 'true';
            document.getElementById(`banner_discription`).contentEditable = 'true';
            document.getElementById('editTrainerBtn').style.display = 'none';
            document.getElementById('saveTrainerBtn').style.display = 'inline-block';

            alert("Slider is now editable. After making changes, click Save.");
        }

        function saveBannerChanges() {
            document.getElementById(`input_banner_subtitle`).value = document.getElementById(`banner_subtitle`).innerText;
            document.getElementById(`input_banner_head`).value = document.getElementById(`banner_head`).innerText;
            document.getElementById(`input_banner_discription`).value = document.getElementById(`banner_discription`).innerText;

        alert("Saving changes to sliders...");
        document.getElementById('bannerEditForm').submit();
        }
    </script>

    <script>
    document.getElementById("projectForm").addEventListener("submit", async function(e) {
        e.preventDefault(); // prevent normal form submission

        const formData = new FormData(this);
        const loadingBar = document.getElementById("loadingBar");
        const notification = document.getElementById("notification");

        // Reset notification and show loading bar
        notification.style.display = "none";
        loadingBar.style.display = "block";
        loadingBar.style.width = "0"; 
        setTimeout(() => { loadingBar.style.width = "100%"; }, 50);

        try {
            const response = await fetch("{% url 'get_project_ideas_request' %}", {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": getCookie("csrftoken")
                }
            });

            // wait a couple of seconds for effect
            await new Promise(resolve => setTimeout(resolve, 2000));

            loadingBar.style.display = "none"; // hide loading bar

            const data = await response.json(); // ✅ parse JSON

            if (data.status === "success") {
                console.log("Success:", data);

                // Show success notification
                notification.style.display = "block";
                notification.style.background = "#e6ffed";
                notification.style.color = "#2d7a46";
                notification.textContent = "✅ " + data.message;
            } else {
                console.error("Error:", data);

                // Show error notification
                notification.style.display = "block";
                notification.style.background = "#ffe6e6";
                notification.style.color = "#a33";
                notification.textContent = "❌ " + data.message;
            }
        } catch (error) {
            console.error("Request failed:", error);

            // Show error notification
            notification.style.display = "block";
            notification.style.background = "#ffe6e6";
            notification.style.color = "#a33";
            notification.textContent = "⚠️ Something went wrong!";
        }
    });

    // Helper function to get CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

</script>

{% endblock scripts %}

